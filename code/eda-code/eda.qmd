---
title: "Codes for exploratory analysis"
date: "2024-02-17"
author: "Prasanga Paudel"
output: html_document
---

  




```{r}
#load needed packages. make sure they are installed.
library(here) #for data loading/saving
library(dplyr)
library(skimr)
library(ggplot2)
library(patchwork)
```


# Loading the data.

We will import the processed data from the processed-data folder which we is the cleaned and transformed dataset.

```{r}
#Path to data. 
data_location <- here::here("data","processed-data","processeddata.rds")
#load data
mydata <- readRDS(data_location)
```


# Data exploration through tables

Here we will present the summary stat for some of the interesting varible based on year 2010 for the OECD countries.

```{r}
library(dplyr)
library(knitr)
library(kableExtra) 

# Filtering data for the year 2010
data_2010 <- mydata %>%
  filter(Year == 2010)

# Create a summary table, excluding specific rows
country_summary_table <- data_2010 %>%
  filter(!CountryName %in% c("Data from database: World Development Indicators", "OECD members"
                              "Last Updated: 01/28/2025")) %>%
  select(
    CountryName,
    GDP_current_US,
    Population_total,
    Life_expectancy_at_birth_total_years,
    Physicians_per_1000_people,
    Hospital_beds_per_1000_people,
    Government_Effectiveness_Estimate,
    Control_of_Corruption_Estimate,
    Rule_of_Law_Estimate,
    Access_to_electricity__of_population,
    Unemployment_total__of_total_labor_force_modeled_ILO_estimate,
    Poverty_headcount_ratio_at_national_poverty_lines__of_population
  )

# Create and display an HTML table in R
country_summary_table %>%
  kable("html", escape = FALSE, digits = 2) %>%
  kable_styling(full_width = F, position = "left") %>%
  column_spec(1, bold = TRUE) %>%  # Making CountryName column bold
  add_header_above(c(" " = 1, "National Development Indicators" = 11)) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

# Data exploration through figures

In this section, we will explore some of the variables and try to look at some of the similarity among the varibles.

First, we will see how "Health Expenditure as a Percentage of GDP Over Time (2010–2020)" is distributed over the years for top 5 OECD countries.The top 5 countries are calculated based on 2010 data.  _Note: The aggregate values visible as "OECD members" will not be used for analysis purpose. It is just for demonstration._

```{r}
# Converting column to numeric before plotting
mydata <- mydata %>%
  mutate(Current_health_expenditure__of_GDP = as.numeric(Current_health_expenditure__of_GDP))

# Filtering top 5 countries based on 2010 health expenditure
top_5_countries <- mydata %>%
  filter(Year == 2010) %>%
  arrange(desc(Current_health_expenditure__of_GDP)) %>%
  slice_head(n = 5) %>%
  pull(CountryName)  # Extracting country names

# Filtering data for only 5 countries over time
data_filtered <- mydata %>%
  filter(CountryName %in% top_5_countries)

y_breaks <- seq(min(data_filtered$Current_health_expenditure__of_GDP, na.rm = TRUE), 
                max(data_filtered$Current_health_expenditure__of_GDP, na.rm = TRUE), 
                length.out = 4)  

# Creating the line plot
ggplot(data_filtered, aes(x = Year, y = Current_health_expenditure__of_GDP, color = CountryName, group = CountryName)) +
  geom_line(size = 1) +
  geom_point(size = 2) +  
  labs(
    title = "Current Health Expenditure as a % of GDP (2010–2020): Top 5 nations",
    x = "Year",
    y = "Health Expenditure (% of GDP)",
    color = "Country"
  ) +
  scale_y_continuous(breaks = y_breaks) +  
  theme_minimal()  

ggsave(
  filename = here("results","figures", "health_expenditure_plot.png"),  
  plot = last_plot(),  # Saves the last plotted figure
  width = 8, 
  height = 6, 
  dpi = 300
)

```




Now, we will try to see if there is any relation between GDP per capita (current US) and current Health Expenditure as a % of GDP.

```{r}

# Converting columns to numeric 
mydata <- mydata %>%
  mutate(
    Current_health_expenditure__of_GDP = as.numeric(Current_health_expenditure__of_GDP),
    GDP_per_capita_current_US = as.numeric(GDP_per_capita_current_US)
  )

# Filtering data for the year 2010
data_2010 <- mydata %>%
  filter(Year == 2010)

# Creating scatter plot
ggplot(data_2010) +
  
  # Plot GDP per capita 
  geom_point(aes(x = GDP_per_capita_current_US, y = Current_health_expenditure__of_GDP), 
             color = "blue", alpha = 0.7, size = 3) +

  # Plot Health Expenditure 
  geom_point(aes(x = GDP_per_capita_current_US, y = Current_health_expenditure__of_GDP), 
             color = "red", alpha = 0.7, size = 3, shape = 17) +  # Shape 17 = Triangle

  # Adding a green regression line
  geom_smooth(aes(x = GDP_per_capita_current_US, y = Current_health_expenditure__of_GDP), 
              method = "lm", color = "green", se = FALSE, size = 1) +
  
  # Labels and title
  labs(
    title = "Health Expenditure vs GDP Per Capita (2010)",
    x = "GDP Per Capita (Current US$)",
    y = "Current Health Expenditure (% of GDP)"
  ) +
  
  
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))  


ggsave(
  filename = here("results","figures", "health_expenditure_gdp.png"),  
  plot = last_plot(),  # Saves the last plotted figure
  width = 8, 
  height = 6, 
  dpi = 300
)
```

Now, we will try to see if there is any relation between hospital beds per 1000 people and current Health Expenditure as a percentage of GDP.

```{r}

# Converting columns to numeric
mydata <- mydata %>%
  mutate(
    Current_health_expenditure__of_GDP = as.numeric(Current_health_expenditure__of_GDP),
    Hospital_beds_per_1000_people = as.numeric(Hospital_beds_per_1000_people)
  )

# Filtering data for the year 2010
data_2010 <- mydata %>%
  filter(Year == 2010)

# Creating scatter plot
ggplot(data_2010) +
  
  # Plot GDP per capita 
  geom_point(aes(x = Hospital_beds_per_1000_people, y = Current_health_expenditure__of_GDP), 
             color = "blue", alpha = 0.7, size = 3) +

  # Plot Health Expenditure 
  geom_point(aes(x = Hospital_beds_per_1000_people, y = Current_health_expenditure__of_GDP), 
             color = "red", alpha = 0.7, size = 3, shape = 17) +  # Shape 17 = Triangle

  # Adding green regression line
  geom_smooth(aes(x = Hospital_beds_per_1000_people, y = Current_health_expenditure__of_GDP), 
              method = "lm", color = "green", se = FALSE, size = 1) +
  
  # Labels and title
  labs(
    title = "Health Expenditure vs GDP Per Capita (2010)",
    x = "Hospital beds per 1000 people",
    y = "Health Expenditure (% of GDP)"
  ) +
  
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))  


ggsave(
  filename = here("results","figures", "hospital_per_bed.png"),  
  plot = last_plot(),  # Saves the last plotted figure
  width = 8, 
  height = 6, 
  dpi = 300
)
```

Let's check if annual population growth shows any relation with current Health Expenditure as a percentage of GDP for Australia

```{r}

# Filtering data for Australia
australia_data <- mydata %>%
  filter(CountryName == "Australia")

# Histogram for Population Growth
plot_pop_growth <- ggplot(australia_data, aes(x = as.factor(Year), y = Population_growth_annual_)) +
  geom_col(fill = "blue", color = "black", alpha = 0.7) +
  labs(
    title = "Annual Population Growth \n Country: Australia",
    x = "Year",
    y = "Annual Population Growth (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))

ggsave(
  filename = here("results","figures", "pop_growth_aus.png"),  
  plot = last_plot(),  # Saves the last plotted figure
  width = 8, 
  height = 6, 
  dpi = 300
)

# Histogram for Health Expenditure
plot_health_expenditure <- ggplot(australia_data, aes(x = as.factor(Year), y = Current_health_expenditure__of_GDP)) +
  geom_col(fill = "red", color = "black", alpha = 0.7) +
  labs(
    title = "Health Expenditure (% of GDP) \n Country: Australia",
    x = "Year",
    y = "Health Expenditure (% of GDP)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))  


ggsave(
  filename = here("results","figures", "health_exp_aus.png"),  
  plot = last_plot(),  
  width = 8, 
  height = 6, 
  dpi = 300
)


# Combine both plots side by side
plot_pop_growth + plot_health_expenditure

```
We can not see a visible relation between these two factors.  Let's try it for France now

```{r}


# Filter data for France
france_data <- mydata %>%
  filter(CountryName == "France")

# Histogram for Population Growth
plot_pop_growth <- ggplot(france_data, aes(x = as.factor(Year), y = Population_growth_annual_)) +
  geom_col(fill = "blue", color = "black", alpha = 0.7) +
  labs(
    title = "Annual Population Growth \n Country: France",
    x = "Year",
    y = "Annual Population Growth (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))  


ggsave(
  filename = here("results","figures", "pop_growth_france.png"),  
  plot = last_plot(),  
  width = 8, 
  height = 6, 
  dpi = 300
)

# Histogram for Health Expenditure
plot_health_expenditure <- ggplot(australia_data, aes(x = as.factor(Year), y = Current_health_expenditure__of_GDP)) +
  geom_col(fill = "red", color = "black", alpha = 0.7) +
  labs(
    title = "Health Expenditure (% of GDP) \n Country: France",
    x = "Year",
    y = "Health Expenditure (% of GDP)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))


ggsave(
  filename = here("results","figures", "health_exp_france.png"),  
  plot = last_plot(),  
  width = 8, 
  height = 6, 
  dpi = 300
)


# Combining both plots side by side
plot_pop_growth + plot_health_expenditure
```
We can not observe a distinct relation between the two variable, we can observe that the Health Expenditure (% of GDP) variable also show less fluctuation across the years for multiple countries. Lets see if Health Expenditure Per Capita (USD) over the Years shows any reation with annual population growth.

```{r}

# Histogram for Population Growth
plot_pop_growth <- ggplot(australia_data, aes(x = as.factor(Year), y = Population_growth_annual_)) +
  geom_col(fill = "blue", color = "black", alpha = 0.7) +
  labs(
    title = "Annual Population Growth \n Country: Australia",
    x = "Year",
    y = "Annual Population Growth (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))  


# Histogram for Health Expenditure Per Capita (Current USD)
plot_health_expenditure <- ggplot(australia_data, aes(x = as.factor(Year), y = Current_health_expenditure_per_capita_current_US)) +
  geom_col(fill = "red", color = "black", alpha = 0.7) +
  labs(
    title = "Health Expenditure Per Capita (USD) \n Country: Australia",
    x = "Year",
    y = "Health Expenditure Per Capita (USD)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels


ggsave(
  filename = here("results","figures", "health_exp_per_capita_aus.png"),  
  plot = last_plot(),  
  width = 8, 
  height = 6, 
  dpi = 300
)


# Combine both plots side by side
plot_pop_growth + plot_health_expenditure

```
The Health Expenditure Per Capita (USD) varriable in fact shows more variation and also show some connections with annual population growth.
```{r}

# Histogram for Population Growth
plot_pop_growth <- ggplot(france_data, aes(x = as.factor(Year), y = Population_growth_annual_)) +
  geom_col(fill = "blue", color = "black", alpha = 0.7) +
  labs(
    title = "Annual Population Growth \n Country: France",
    x = "Year",
    y = "Annual Population Growth (%)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels

# Histogram for Health Expenditure Per Capita (Current USD)
plot_health_expenditure <- ggplot(france_data, aes(x = as.factor(Year), y = Current_health_expenditure_per_capita_current_US)) +
  geom_col(fill = "red", color = "black", alpha = 0.7) +
  labs(
    title = "Health Expenditure Per Capita (USD) \n Country: France",
    x = "Year",
    y = "Health Expenditure Per Capita (USD)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))  

ggsave(
  filename = here("results","figures", "health_exp_per_capita_france.png"),  
  plot = last_plot(),  
  width = 8, 
  height = 6,
  dpi = 300
)

# Combine both plots side by side
plot_pop_growth + plot_health_expenditure
```
The results for Australia can also confirmed for France, we may be able to use Health Expenditure Per Capita (USD) as a dependent variabe in our future analysis.




# Notes

For your own explorations, tables and figures can be "quick and dirty". As long as you can see what's going on, there is no need to polish them. That's in contrast to figures you'll produce for your final products (paper, report, presentation, website, etc.). Those should look as nice, polished and easy to understand as possible.


